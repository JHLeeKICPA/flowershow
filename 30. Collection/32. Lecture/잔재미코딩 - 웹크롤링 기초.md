---
category:
  - 02. 웹크롤링
status:
  - In-Progress
note: false
collection:
  - 📼Lecture
share_link: https://share.note.sx/onep1dom#9OJ+9a7Xg5sl5V98iBTZ6WXq3Ps/IWly4hjCPn19JT0
share_updated: 2025-07-17T20:35:38+09:00
---
## 크롤링 핵심 코드 패턴

```python hl:6,12
#1. 라이브러리 임포트
import requests 
from bs4 import BeautifulSoup  

#2. 웹페이지 가져오기
res = requests.get('http://v.media.daum.net/v/20170615203441266') 

#3. 웹페이지 파싱
soup = BeautifulSoup(res.content, 'html.parser') 

#4. 필요한 데이터 추출
mydata = soup.find('title') 

#5. 추출한 데이터 활용(프로그래밍)
print(mydata.get_text())
```

#### 1. 라이브러리 임포트
- 필요 라이브러리
	- requests: 웹페이지 가져오기
	- bs4 (BeautifulSoup): 웹페이지 분석(크롤링)

#### 2. 웹페이지 가져오기
- HTML 파일 확인
	1. 웹 브라우저로 확인: 오른쪽 클릭 + 페이지 소스 보기
	2. 라이브러리로 확인하기: `res.content`

#### 3. 웹페이지 파싱
- html.parser → HTML을 파싱

#### 4. 필요한 데이터 추출
- 이 부분이 크롤링의 핵심
- `soup.find()` 함수로 원하는 부분을 지정
- `변수.get_text()` 함수로 추출한 부분을 가져올 수 있음

#### 5. 추출한 데이터 활용
- 필요한 데이터를 변수에 넣으면 이후 활용은 프로그래밍 영역

## 웹 기본 이해

#### 1. HTML

```HTML
<!DOCTYPE html> 
<html> 
	<head>
		<title> Dave Lee's blog</title>
		<meta charset="utf-8">
	</head>
	<body>
		<b> Hello HTML </b>
	</body>
</html>
```
- 언어의 특성
	- 마크업 언어(xml 등): 문서나 페이지의 구조를 표현
	- <태그> 로 시작, </태그>로 끝
	- 클라이언트가 HTML 파일을 요청하면 서버가 HTML 파일을 전달
- 웹브라우저로 HTML을 오픈했는데 글자가 깨지는 경우 다음 태그를 head 태그 안에 넣을 것(문자 인코딩)
	- `<meta charset="utf-8">`
- 태그에는 속성을 넣을 수 있음
	![[Pasted image 20250708052733.png|425]]
- 태그로 표 만들 수 있음
	![[Pasted image 20250708052834.png|425]]
- 필요한 태그는 사전처럼 그때그때 찾아볼 것
	- [HTML 요소 참고서 - HTML: Hypertext Markup Language | MDN](https://developer.mozilla.org/ko/docs/Web/HTML/Reference/Elements)

#### 2. CSS
```CSS
/* 1. style 속성으로 태그에 넣기*/
<td style="text-align:center;color:blue">

/* 2. head에 <style> 태그로 넣기*/
<style type="text/css">
	td{
		font-size: 2em;
		font-family: Gulim;
		text-align: center;
		}
</style>

/*3. CSS 파일로 넣기*/
<head>
	<title>Dave Lee blog</title>
	<link rel = "stylesheet" type="text/css" href="css/style.css">
</head>

/*4. CSS 스타일 만들기*/
.cssname {
		font-size: 14px;
		background-color: #111111
}

<tr class="cssname">
<td>abc</td>
</tr>
```
- 언어의 특성
	- HTML 문서를 꾸미는 언어
- CSS 언어 적용 방법
	1. style 속성으로 태그에 넣기
		![[Pasted image 20250710003051.png|425]]
	2. head에 `<style>` 태그로 넣기
		![[Pasted image 20250710003148.png|425]]
	3. CSS 파일로 넣기
		- CSS파일에 style 태그 넣고 적용
			![[Pasted image 20250710004234.png|425]]
			![[Pasted image 20250710004417.png|425]]
		- CSS 파일에 class 만들고 적용
			![[Pasted image 20250710004339.png|425]]
		- 
	4. Class 만들기
		![[Pasted image 20250710004013.png|475]]
		![[Pasted image 20250710004033.png|475]]

## 웹 이해를 바탕으로 크롤링
#### 1. HTML 언어 이해를 바탕으로 크롤링
![[Pasted image 20250710001908.png]]
- 태그 문장이 2개 이상일 때 하나를 선택하는 방법
	- 속성(attribute)을 지정
		- `data = soup.find('p', class_='cssstyle')`
		- `data = soup.find('p', attrs = {'align': 'center'}, {'id': 'body'})`
	- class를 지정
		- `data = soup.find('p', 'cssstyle')`
	- id를 지정
		- `data = soup.find(id='body')`
- 태그 문장이 여러개일 때 모두 가져오는 방법
	- find_all( ) 함수 사용 → 리스트로 가져옴 → 반복문으로 추출 필요
		- `data = soup.find_all('p')
- class는 CSS언어와 함께 사용

#### 2. CSS 언어 이해를 바탕으로 크롤링
```python
# find('tag', 'class명')
data = soup.find('h3', 'tit_view') print(data.get_text())
```
##


## Open API와 데이터를 다루는 포맷 이해와 활용

#### Open API란?
- API(Application Programming Interface)
	- 특정 프로그램을 만들기 위해 제공되는 모듈(함수 등)을 의미
- Oepn API(=공개 API)
	- 누구나 사용할 수 있도록 공개된 API(주로 Rest API 기술 활용)
- Rest API(Representational State Transfer API)
	- HTTP프로토콜을 통해 서버 제공 기능을 사용할 수 있는 함수
	- 일반적으로 XML, JSON 형태로 응답을 전달 
	- (참고) [REST API란?](https://hyunalee.tistory.com/1)

#### JSON이란?
- JSON(JavaScript Object Notation)
	- 웹 환경에서 서버와 클라이언트 사이에 데이터를 주고 받을 때 많이 사용
	- Dictionary와 유사
	- 예시포맷
		- `{json}{ "id":"01", "language": "Java", "edition": "third", "author": "Herbert Schildt" }

#### 네이버 Open API를 이용한 크롤링 간단 실습
- [네이버 Open API 등록](https://developers.naver.com/apps/#/list)
- [네이버 서비스 API 설명](https://developers.naver.com/products/service-api/datalab/datalab.md)
- 예시 1. 네이버 쇼핑 검색결과 출력 - 기본(default로 출력)
```python
import requests

# client id와 password 입력
client_id = 'BTMVavws8Is7jmVpUcSL'
client_secret = 'sDgiapg86l'

# api 주소와 헤더 정보 입력
naver_open_api = 'https://openapi.naver.com/v1/search/shop.json?query=갤럭시노트10'
header_params = {"X-Naver-Client-Id":client_id, "X-Naver-Client-Secret":client_secret} # 헤더에 정보를 추가

# get으로 데이터를 받아옴
res = requests.get(naver_open_api, headers=header_params)

# data 원하는 형태로 출력
if res.status_code == 200: # 정상 여부 판단
    data = res.json() #json 형태로 데이터를 가져옴
    for index, item in enumerate(data['items']): # enumerate: index와 item에 각각 번호와 item을 넣음
        print (index + 1, item['title'], item['link'])
else:
    print ("Error Code:", res.status_code)
```
- 예시 2. 네이버 쇼핑 검색결과 출력 - 추가 쿼리(순서대로 1000개 출력), 엑셀로 저장
```python
import requests
import openpyxl

client_id = '1liFJhSrq0LnzWIKnnrh'
client_secret = 'VqzMJYREbw'
start, num = 1, 0

#엑셀파일 만들기
excel_file = openpyxl.Workbook()
excel_sheet = excel_file.active
excel_sheet.column_dimensions['B'].width = 100
excel_sheet.column_dimensions['C'].width = 100
excel_sheet.append(['랭킹', '제목', '링크'])

for index in range(10):
    start_number = start + (index * 100) #1, 101,201, 301 등으로 설정
    naver_open_api = 'https://openapi.naver.com/v1/search/shop.json?query=샤오미&display=100&start=' + str(start_number) #start_num부터 100개씩 출력
    header_params = {"X-Naver-Client-Id":client_id, "X-Naver-Client-Secret":client_secret}
    res = requests.get(naver_open_api, headers=header_params)
    if res.status_code == 200:
        data = res.json()
        for item in data['items']:
            num += 1
            excel_sheet.append([num, item['title'], item['link']])
    else:
        print ("Error Code:", res.status_code)

excel_file.save('IT.xlsx')
excel_file.close()
```

## XLM 데이터 포맷 다루기

#### XLM(Extensible Markup Language이란?
- XML(Extensible Markup Language)
    - 특정 목적에 따라 데이터를 **태그로 감싸서 마크업**하는 범용적인 포멧
    - 마크업 언어는 태그 등을 이용하여 데이터의 구조를 기술하는 언어의 한 가지
    - 가장 친숙한 마크업 언어가 HTML
    - XML은 HTML과 마찬가지로 데이터를 계층 구조로 표현
    - XML 기본 구조
        - `{XML} <태그 속성="속성값">내용</태그>} `
        - 태그와 속성은 특정 목적에 따라 임의로 이름을 정해서 사용
        - 다른 요소와 그룹으로 묶을 수도 있음
- 예시 코드
```python
xmldata = ''' 실제 데이터'''
from bs4 import BeautifulSoup

soup = BeautifulSoup(xmldata, 'lxml') #parser 이름이 'lxml'

data = soup.find_all('item')
for item in data:
    datatime = item.find('datatime')
    informcode = item.find('informcode') # informCode 와 같이 대문자로 쓰면 추출하지 못하는 현상이 있음
    print (datatime.get_text(), informcode.get_text())
```

#### Open API와 XML
- 예시 코드
```python
# OPEN API 예 (보통 OPEN API 는 각 OPEN API 를 호출하는 파이썬 샘플 코드와 사용법을 설명하는 경우가 많음)
import requests

url = 'http://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getMinuDustFrcstDspth'
request_params = {
    'serviceKey' : '여러분들의 서비스키', # 서비스키를 발급 받아서, 넣어줘야 하는 케이스가 많음
    'returnType' : 'xml', # 데이터를 xml 형식으로 받으려면, returnType 에 xml 값을 넣어주라고 가이드함
    'numOfRows' : '100', # 몇 개의 데이터를 받아올지를 numOfRows 에 값을 넣어주라고 가이드함
    'pageNo' : '1', # 수천개의 데이터이면 이를 페이지로 잘라서, 그중 몇번째 페이지의 데이터를 받아올지를, pageNo 에 넣어주라고 가이드함
    'searchDate' : '2024-03-22', # 어느 날짜에 해당하는 데이터를 가져올지를, searchDate 에 넣어주라고 가이드함
    'InformCode' : 'PM10' # 어떤 타입의 데이터를 가져올지를, InformCode 에 넣어주라고 가이드함
}

response = requests.get(url, params=request_params) # requests.get() 으로 주소와 요청 데이터를 넣어줄 수 있음

# 응답 데이터를 'utf-8'로 디코딩 (가져온 데이터가 깨져보이면, 인코딩 방식을 설정하여, 해당 인코딩 방식으로 변환하도록 할 수 있음)
xml_data = response.content.decode('utf-8')

# 가져온 데이터를 파싱하고, 원하는 데이터를 추출하는 코드를 추가하여, 원하는 데이터만 가져올 수 있음
soup = BeautifulSoup(xml_data, 'lxml')

data = soup.find_all('item')
for item in data:
    datatime = item.find('datatime')
    informcode = item.find('informcode') # informCode 와 같이 대문자로 쓰면 추출하지 못하는 현상이 있음
    print (datatime.get_text(), informcode.get_text())
```

## 문자열 관련 함수

#### count
- 문자열에 있는 특정 문자의 갯수 반환
```python
data = 'Dave David'
data.count('v') # output: 2
data.count('Dave') # output: 1
```

#### index
- 문자열에 있는 특정 문자의 위치 반환
	- 가장 먼저 나오는 위치
	- 해당 문자가 없으면 에러 발생
```python
string = 'Dave ID is dave'
string.index('i')   # output: 8
string.index('x') # output: error
```

#### find
- index와 동일하나, 해당 문자가 없으면 -1을 반환
```python
string = 'dave is david'
string.find('x') # output: -1
if string.find('x') == -1:
    print ("x는 스트링에 없습니다.") # output: "x는 스트링에 없습니다."
```

#### join
- 문자열 사이에 다른 문자 넣기
- 껴넣을 문자.join(문자열)
```python
string = "12345"
comma = ','
comma.join(string)     # output: '1,2,3,4,5'
```

#### strip / lstrip / rstrip
- 문자열 앞뒤 공백 또는 다른 문자 지우기(default: 공백)
	- 앞 뒤 공백이 여러개 있어도 한 번에 다 지움
	- strip("문자1문자2문자3") → 문자 여러 개 다 지움
```python
string = "     David  "
string.strip()      # output: "David"
string.lstrip()    # output: "David "
string.rstrip()    # output: "    David"

string2 = "    9999999999999999(Dave)888888888888888888     "
string2.strip(" 98()") # output: "Dave"
```

#### upper, lower
- 소문자 → 대문자 / 대문자 → 소문자
```python
string = 'Dave'
string.lower()   # output: 'dave' 
string.upper()   # output: 'DAVE'
```

#### split
- 문자열을 나눠서 리스트로 반환
- 문자열.split('분리할 기준 문자') (default: 공백)
```python
string = "10,11,22,33,44" 
listdata = string.split(',')   # output: ['10', '11', '22', '33', '44']

for index, listitem in enumerate(listdata):
    listdata[index] = int(listitem)
print (listdata)  # output: [10, 11, 22, 33, 44]
```

#### replace
- 문자열 중 일부를 다른 문자로 바꾸거나 삭제
```python
string = "David goes to Korea"
string.replace("David", "Dave")   # output: 'Dave goes to Korea'

string2 = "(Dave)"
string2.replace("()", "")   # output: '(Dave)'
string2.replace("(", "").replace(")", "")   # output: 'Dave'
```

## 정규표현식

#### 정규표현식이란?
- 특정한 규칙을 가진 문자열의 집합을 표현하는데 사용하는 형식
- 일정한 규칙을 가지고 작성되며 필요한 패턴은 직접 만들 수 있음

| 정규 표현식         | 축약 표현 | 사용 예                                                           |
| -------------- | ----- | -------------------------------------------------------------- |
| [0-9]          | \d    | 숫자를 찾음                                                         |
| [^0-9]         | \D    | 숫자가 아닌 것을 찾음(텍스트, 특수 문자, white space(스페이스, 탭, 엔터 등등)를 찾을 때)    |
| [ \t\n\r\f\v]  | \s    | white space(스페이스, 탭, 엔터 등등) 문자인 것을 찾음                          |
| [^ \t\n\r\f\v] | \S    | white space(스페이스, 탭, 엔터 등등) 문자가 아닌 것을 찾음(텍스트, 특수 문자, 숫자를 찾을 때) |
| [A-Za-z0-9]    | \w    | 문자, 숫자를 찾음                                                     |
| [^A-Za-z0-9]   | \W    | 문자, 숫자가 아닌 것을 찾음                                               |

#### 정규표현식 패턴

#### 정규표현식 함수

